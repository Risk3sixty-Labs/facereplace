#!/usr/bin/env node

!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){e.exports=require("face-api.js")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("canvas")},function(e,t,r){"use strict";var a=r(2),n=r.n(a),i=r(9),o=r.n(i);t.a={getUrlBuffer:async e=>await o()({method:"GET",url:e,encoding:null}),async checkAndCreateDirectory(e){try{return await this.doesDirectoryExist(e)||await n.a.promises.mkdir(e),!0}catch(e){if("EEXIST"==e.code)return!0;throw e}},async doesDirectoryExist(e){try{return(await n.a.promises.stat(e)).isDirectory()}catch(e){return!1}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r(6),n=r.n(a);function i(e=null){return{image:e,async open(e){return this.image=await n.a.read(e)},async toBuffer(e=this.image){return await e.getBufferAsync(n.a.MIME_JPEG)},cover(e,t=null){return this.image.cover(e,t||e)},composite(e,t,r){return this.image.composite(e,t,r)}}}},function(e,t){e.exports=require("jimp")},function(e,t){e.exports=require("minimist")},function(e,t,r){"use strict";(function(e){var a=r(1),n=r.n(a),i=(r(16),r(3)),o=r(0);const{Canvas:c,Image:s,ImageData:u}=i;o.env.monkeyPatch({Canvas:c,Image:s,ImageData:u}),t.a={faceDetectionNet:o.nets.ssdMobilenetv1,loadedNet:!1,async init(){this.loadedNet||(await this.faceDetectionNet.loadFromDisk(n.a.join(e,"..","..","weights")),this.loadedNet=!0)},async drawFaceOutlines(e){await this.init();const t=await i.loadImage(e),r=await o.detectAllFaces(t,this.getFaceDetectorOptions(this.faceDetectionNet)),a=o.createCanvasFromMedia(t);return o.draw.drawDetections(a,r),[r,a.toBuffer("image/jpeg")]},getFaceDetectorOptions:e=>e===o.nets.ssdMobilenetv1?new o.SsdMobilenetv1Options({minConfidence:.5}):new o.TinyFaceDetectorOptions({inputSize:408,scoreThreshold:.5})}}).call(this,"/")},function(e,t){e.exports=require("request-promise-native")},function(e,t,r){r(11),r(12),e.exports=r(13)},function(e,t){e.exports=require("core-js/stable")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t,r){"use strict";r.r(t);var a=r(2),n=r.n(a),i=r(1),o=r.n(i),c=(r(14),r(7));const s=r.n(c)()(process.argv.slice(2));!async function(){try{const e=s.f||s.face,t=s.p||s.pic;if(!e)throw new Error("enter the path or URL to a picture of a face to replace in your target picture");if(!t)throw new Error("enter the path or URL to a picture to replace faces in");const a=r(15).default,i=o.a.extname(t),c=o.a.join(process.env.HOME||process.env.USERPROFILE,`facereplace_${Date.now()}${i||"jpeg"}`),u=a(e),l=await u.replace(t);await n.a.promises.writeFile(c,l),console.log(`Successfully replaced faces and saved your file here: ${c}`.green)}catch(e){console.error("Error replacing faces",e)}finally{process.exit()}}()},function(e,t){e.exports=require("colors")},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"default",(function(){return l}));var a=r(2),n=r.n(a),i=r(1),o=r.n(i),c=r(8),s=r(4),u=r(5);function l(t){return{faceReplacePath:t,tmpPath:o.a.join(e,"..","tmp"),setFacePicture(e){this.faceReplacePath=e},async replace(e){const t=Object(u.a)();await s.a.checkAndCreateDirectory(this.tmpPath),await this.confirmFacePathIsSet();let r=e;this.isStringValidUrl(r)&&(r=await this.getFileAndStoreLocally(r)),await t.open(r);const[a]=await c.a.drawFaceOutlines(r);return await Promise.all(a.map(async e=>{const r=Object(u.a)();await r.open(this.faceReplacePath),r.cover(parseInt(e._box._width),parseInt(e._box._height)),t.composite(r.image,parseInt(e._box._x),parseInt(e._box._y))})),await t.toBuffer()},async getFileAndStoreLocally(e){const t=e.split("/"),r=t[t.length-1],a=await s.a.getUrlBuffer(e),i=o.a.join(this.tmpPath,r);return await n.a.promises.writeFile(i,a),i},async confirmFacePathIsSet(){if(!this.faceReplacePath)throw new Error("Make sure a face replacement picture is set");return this.isStringValidUrl(this.faceReplacePath)?this.faceReplacePath=await this.getFileAndStoreLocally(this.faceReplacePath):this.faceReplacePath},isStringValidUrl:e=>/^https*\:\/\//.test(e)}}}.call(this,"/")},function(e,t){e.exports=require("@tensorflow/tfjs-node")}]);